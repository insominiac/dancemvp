"use strict";(()=>{var e={};e.id=98,e.ids=[98],e.modules={3524:e=>{e.exports=require("@prisma/client")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},7778:(e,t,s)=>{s.r(t),s.d(t,{originalPathname:()=>m,patchFetch:()=>b,requestAsyncStorage:()=>c,routeModule:()=>p,serverHooks:()=>g,staticGenerationAsyncStorage:()=>d});var r={};s.r(r),s.d(r,{POST:()=>l});var n=s(9303),o=s(8716),i=s(670),a=s(7070),u=s(3474);async function l(e){try{let{classId:t,eventId:s,name:r,email:n,phone:o,emergencyContact:i,emergencyPhone:l,experience:p,notes:c}=await e.json(),d=await u.Z.user.findUnique({where:{email:n}});d||(d=await u.Z.user.create({data:{email:n,name:r,phoneNumber:o,password:"temp_booking_user",role:"Student"}}));let g="Class",m="0";if(t){let e=await u.Z.class.findUnique({where:{id:t},select:{price:!0,maxStudents:!0},include:{_count:{select:{bookings:{where:{status:{in:["CONFIRMED","COMPLETED"]}}}}}}});if(!e)return a.NextResponse.json({error:"Class not found"},{status:404});if(e._count.bookings>=e.maxStudents)return a.NextResponse.json({error:"Class is full"},{status:400});m=e.price.toString(),g="Class"}else if(s){let e=await u.Z.event.findUnique({where:{id:s},select:{price:!0,maxAttendees:!0},include:{_count:{select:{bookings:{where:{status:{in:["CONFIRMED","COMPLETED"]}}}}}}});if(!e)return a.NextResponse.json({error:"Event not found"},{status:404});if(e._count.bookings>=e.maxAttendees)return a.NextResponse.json({error:"Event is full"},{status:400});m=e.price.toString(),g="Event"}let b=await u.Z.booking.create({data:{userId:d.id,classId:t||null,eventId:s||null,bookingType:g,status:"PENDING",amount:parseFloat(m),notes:c||`Emergency Contact: ${i} (${l}). Experience: ${p}`}});return a.NextResponse.json({success:!0,bookingId:b.id,message:"Booking created successfully. Awaiting payment confirmation."})}catch(e){return console.error("Error creating booking:",e),a.NextResponse.json({error:"Failed to create booking"},{status:500})}}let p=new n.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/public/bookings/route",pathname:"/api/public/bookings",filename:"route",bundlePath:"app/api/public/bookings/route"},resolvedPagePath:"/Users/hemantd/DL/dance-platform/app/api/public/bookings/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:c,staticGenerationAsyncStorage:d,serverHooks:g}=p,m="/api/public/bookings/route";function b(){return(0,i.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:d})}},3474:(e,t,s)=>{s.d(t,{Z:()=>n});var r=s(3524);let n=global.prisma||new r.PrismaClient}};var t=require("../../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[948,972],()=>s(7778));module.exports=r})();