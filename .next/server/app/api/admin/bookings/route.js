"use strict";(()=>{var e={};e.id=602,e.ids=[602],e.modules={3524:e=>{e.exports=require("@prisma/client")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4909:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>h,patchFetch:()=>k,requestAsyncStorage:()=>l,routeModule:()=>p,serverHooks:()=>m,staticGenerationAsyncStorage:()=>g});var s={};r.r(s),r.d(s,{GET:()=>d,POST:()=>c});var n=r(9303),o=r(8716),a=r(670),i=r(7070);let u=new(r(3524)).PrismaClient;async function d(e){try{let t=e.nextUrl.searchParams,r=parseInt(t.get("page")||"1"),s=parseInt(t.get("limit")||"10"),n=t.get("status")||"",o=t.get("userId")||"",a=t.get("classId")||"",d=t.get("eventId")||"",c=(r-1)*s,p={...n&&{status:n},...o&&{userId:parseInt(o)},...a&&{classId:parseInt(a)},...d&&{eventId:parseInt(d)}},[l,g]=await Promise.all([u.booking.findMany({where:p,skip:c,take:s,orderBy:{createdAt:"desc"},include:{user:!0,class:{include:{classInstructors:{include:{instructor:{include:{user:!0}}}}}},event:{include:{venue:!0}},transactions:!0}}),u.booking.count({where:p})]);return i.NextResponse.json({bookings:l,pagination:{total:g,page:r,limit:s,totalPages:Math.ceil(g/s)}})}catch(e){return console.error("Error fetching bookings:",e),i.NextResponse.json({error:"Failed to fetch bookings"},{status:500})}}async function c(e){try{let{userId:t,classId:r,eventId:s,status:n,amountPaid:o,paymentMethod:a,notes:d}=await e.json();if(!r&&!s)return i.NextResponse.json({error:"Either classId or eventId must be provided"},{status:400});if(r&&s)return i.NextResponse.json({error:"Only one of classId or eventId should be provided"},{status:400});if(await u.booking.findFirst({where:{userId:t,...r?{classId:r}:{eventId:s}}}))return i.NextResponse.json({error:"User already has a booking for this class/event"},{status:400});let c=await u.booking.create({data:{userId:t,classId:r,eventId:s,status:n||"PENDING",amountPaid:parseFloat(o),paymentMethod:a,notes:d},include:{user:!0,class:!0,event:!0}});return s&&"CONFIRMED"===n&&await u.event.update({where:{id:s},data:{currentAttendees:{increment:1}}}),i.NextResponse.json({message:"Booking created successfully",booking:c},{status:201})}catch(e){return console.error("Error creating booking:",e),i.NextResponse.json({error:"Failed to create booking"},{status:500})}}let p=new n.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/admin/bookings/route",pathname:"/api/admin/bookings",filename:"route",bundlePath:"app/api/admin/bookings/route"},resolvedPagePath:"/Users/hemantd/DL/dance-platform/app/api/admin/bookings/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:l,staticGenerationAsyncStorage:g,serverHooks:m}=p,h="/api/admin/bookings/route";function k(){return(0,a.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:g})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[948,972],()=>r(4909));module.exports=s})();