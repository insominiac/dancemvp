"use strict";(()=>{var e={};e.id=791,e.ids=[791],e.modules={3524:e=>{e.exports=require("@prisma/client")},2934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},2781:e=>{e.exports=require("stream")},3837:e=>{e.exports=require("util")},3684:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>f,patchFetch:()=>x,requestAsyncStorage:()=>h,routeModule:()=>m,serverHooks:()=>y,staticGenerationAsyncStorage:()=>g});var s={};t.r(s),t.d(s,{DELETE:()=>p,GET:()=>u,PUT:()=>d});var n=t(9303),a=t(8716),i=t(670),o=t(3524),c=t(290);let l=new o.PrismaClient,u=(0,c.c)(async(e,{params:r,user:t})=>{console.log(`✅ Admin ${t.email} fetching class ${r.id}`);let s=await l.class.findUnique({where:{id:r.id},include:{classInstructors:{include:{instructor:{include:{user:!0}}}},classStyles:{include:{style:!0}},bookings:{include:{user:!0},orderBy:{createdAt:"desc"},take:10},_count:{select:{bookings:!0}}}});return s?c.R.success(s):c.R.notFound("Class not found")}),d=(0,c.c)(async(e,{params:r,user:t})=>{console.log(`✅ Admin ${t.email} updating class ${r.id}`);try{let{title:t,description:s,level:n,durationMins:a,maxCapacity:i,price:o,scheduleDays:u,scheduleTime:d,requirements:p,imageUrl:m,isActive:h,instructorIds:g,styleIds:y}=await e.json();await l.class.update({where:{id:r.id},data:{title:t,description:s,level:n,durationMins:parseInt(a),maxCapacity:parseInt(i),price:parseFloat(o),scheduleDays:u,scheduleTime:d,requirements:p,imageUrl:m,isActive:h}}),void 0!==g&&(await l.classInstructor.deleteMany({where:{classId:r.id}}),g.length>0&&await l.classInstructor.createMany({data:g.map((e,t)=>({classId:r.id,instructorId:e,isPrimary:0===t}))})),void 0!==y&&(await l.classStyle.deleteMany({where:{classId:r.id}}),y.length>0&&await l.classStyle.createMany({data:y.map(e=>({classId:r.id,styleId:e}))}));let f=await l.class.findUnique({where:{id:r.id},include:{classInstructors:{include:{instructor:{include:{user:!0}}}},classStyles:{include:{style:!0}}}});return c.R.success({message:"Class updated successfully",class:f})}catch(e){throw console.error("Error updating class:",e),Error("Failed to update class")}}),p=(0,c.c)(async(e,{params:r,user:t})=>{console.log(`✅ Admin ${t.email} deleting class ${r.id}`);try{if(await l.booking.count({where:{classId:r.id,status:{in:["CONFIRMED","PENDING"]}}})>0)return c.R.error("Cannot delete class with active bookings",400);return await l.class.delete({where:{id:r.id}}),c.R.success({message:"Class deleted successfully"})}catch(e){throw console.error("Error deleting class:",e),Error("Failed to delete class")}}),m=new n.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/admin/classes/[id]/route",pathname:"/api/admin/classes/[id]",filename:"route",bundlePath:"app/api/admin/classes/[id]/route"},resolvedPagePath:"/Users/hemantd/DL/dance-platform/app/api/admin/classes/[id]/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:h,staticGenerationAsyncStorage:g,serverHooks:y}=m,f="/api/admin/classes/[id]/route";function x(){return(0,i.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:g})}},290:(e,r,t)=>{t.d(r,{R:()=>i,c:()=>a});var s=t(7070),n=t(5306);function a(e){return async(r,t)=>{try{let s=await (0,n.kF)(r),a=t?.params||t;return await e(r,{params:a,user:s})}catch(e){if(console.error("Admin API Error:",e),"Authentication required"===e.message)return s.NextResponse.json({error:"Authentication required"},{status:401});if("Admin privileges required"===e.message)return s.NextResponse.json({error:"Admin privileges required"},{status:403});return s.NextResponse.json({error:e.message||"Internal server error"},{status:500})}}}let i={success:(e,r=200)=>s.NextResponse.json(e,{status:r}),created:e=>s.NextResponse.json(e,{status:201}),error:(e,r=400)=>s.NextResponse.json({error:e},{status:r}),notFound:(e="Resource not found")=>s.NextResponse.json({error:e},{status:404}),unauthorized:(e="Authentication required")=>s.NextResponse.json({error:e},{status:401}),forbidden:(e="Insufficient permissions")=>s.NextResponse.json({error:e},{status:403})}},5306:(e,r,t)=>{t.d(r,{Ov:()=>p,ed:()=>d,kF:()=>u});var s=t(1615),n=t(1482),a=t.n(n),i=t(3474);let o=()=>process.env.JWT_SECRET||"development-secret-key-replace-in-production";async function c(e){try{return a().verify(e,o())}catch(e){return console.error("Token verification failed:",e),null}}async function l(e){try{let r=e.headers.get("authorization"),t=r?.replace("Bearer ",""),n=s.cookies().get("auth-token")?.value,a=t||n;if(!a)return null;let o=await c(a);if(!o)return null;return await i.Z.user.findUnique({where:{id:o.userId},select:{id:!0,email:!0,fullName:!0,role:!0,isVerified:!0}})}catch(e){return console.error("Error getting current user:",e),null}}async function u(e){let r=await l(e);if(!r)throw Error("Authentication required");if(r?.role!=="ADMIN")throw Error("Admin privileges required");return r}async function d(e){let r=function(e){let r={userId:e.id,email:e.email,role:e.role};return a().sign(r,o(),{expiresIn:"7d"})}(e);return(0,s.cookies)().set("auth-token",r,{httpOnly:!0,secure:!0,sameSite:"lax",maxAge:604800}),r}async function p(){(0,s.cookies)().delete("auth-token")}},3474:(e,r,t)=>{t.d(r,{Z:()=>n});var s=t(3524);let n=global.prisma||new s.PrismaClient}};var r=require("../../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[948,972,261],()=>t(3684));module.exports=s})();