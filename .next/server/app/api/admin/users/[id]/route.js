"use strict";(()=>{var e={};e.id=317,e.ids=[317],e.modules={3524:e=>{e.exports=require("@prisma/client")},2934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},2781:e=>{e.exports=require("stream")},3837:e=>{e.exports=require("util")},2468:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>g,patchFetch:()=>q,requestAsyncStorage:()=>x,routeModule:()=>h,serverHooks:()=>y,staticGenerationAsyncStorage:()=>w});var s={};t.r(s),t.d(s,{DELETE:()=>m,GET:()=>p,PUT:()=>f});var n=t(9303),i=t(8716),a=t(670),o=t(7070),u=t(3524),d=t(8691),c=t(5306);let l=new u.PrismaClient;async function p(e,{params:r}){try{await (0,c.kF)(e);let t=await l.user.findUnique({where:{id:r.id},include:{instructor:!0,bookings:{include:{class:!0,event:!0},orderBy:{createdAt:"desc"},take:10},userStyles:{include:{style:!0}},testimonials:!0,notifications:{orderBy:{createdAt:"desc"},take:5}}});if(!t)return o.NextResponse.json({error:"User not found"},{status:404});let{passwordHash:s,...n}=t;return o.NextResponse.json(n)}catch(e){if(console.error("Error fetching user:",e),"Authentication required"===e.message)return o.NextResponse.json({error:"Authentication required"},{status:401});if("Admin privileges required"===e.message)return o.NextResponse.json({error:"Admin privileges required"},{status:403});return o.NextResponse.json({error:"Failed to fetch user"},{status:500})}}async function f(e,{params:r}){try{await (0,c.kF)(e);let{email:t,password:s,fullName:n,phone:i,role:a,bio:u,isVerified:p,websiteUrl:f,instagramHandle:m,profileImage:h}=await e.json(),x={email:t,fullName:n,phone:i,role:a,bio:u,isVerified:p,websiteUrl:f,instagramHandle:m,profileImage:h};s&&(x.passwordHash=await d.ZP.hash(s,10));let w=await l.user.update({where:{id:r.id},data:x});"INSTRUCTOR"===a?await l.instructor.findUnique({where:{userId:r.id}})||await l.instructor.create({data:{userId:r.id,isActive:!0}}):await l.instructor.deleteMany({where:{userId:r.id}});let{passwordHash:y,...g}=w;return o.NextResponse.json({message:"User updated successfully",user:g})}catch(e){return console.error("Error updating user:",e),o.NextResponse.json({error:"Failed to update user"},{status:500})}}async function m(e,{params:r}){try{let t=await (0,c.kF)(e);if(r.id===t.id)return o.NextResponse.json({error:"Cannot delete your own admin account"},{status:400});if(!await l.user.findUnique({where:{id:r.id}}))return o.NextResponse.json({error:"User not found"},{status:404});return await l.user.delete({where:{id:r.id}}),o.NextResponse.json({message:"User deleted successfully"})}catch(e){return console.error("Error deleting user:",e),o.NextResponse.json({error:"Failed to delete user"},{status:500})}}let h=new n.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/admin/users/[id]/route",pathname:"/api/admin/users/[id]",filename:"route",bundlePath:"app/api/admin/users/[id]/route"},resolvedPagePath:"/Users/hemantd/DL/dance-platform/app/api/admin/users/[id]/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:x,staticGenerationAsyncStorage:w,serverHooks:y}=h,g="/api/admin/users/[id]/route";function q(){return(0,a.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:w})}},5306:(e,r,t)=>{t.d(r,{Ov:()=>p,ed:()=>l,kF:()=>c});var s=t(1615),n=t(1482),i=t.n(n),a=t(3474);let o=()=>process.env.JWT_SECRET||"development-secret-key-replace-in-production";async function u(e){try{return i().verify(e,o())}catch(e){return console.error("Token verification failed:",e),null}}async function d(e){try{let r=e.headers.get("authorization"),t=r?.replace("Bearer ",""),n=s.cookies().get("auth-token")?.value,i=t||n;if(!i)return null;let o=await u(i);if(!o)return null;return await a.Z.user.findUnique({where:{id:o.userId},select:{id:!0,email:!0,fullName:!0,role:!0,isVerified:!0}})}catch(e){return console.error("Error getting current user:",e),null}}async function c(e){let r=await d(e);if(!r)throw Error("Authentication required");if(r?.role!=="ADMIN")throw Error("Admin privileges required");return r}async function l(e){let r=function(e){let r={userId:e.id,email:e.email,role:e.role};return i().sign(r,o(),{expiresIn:"7d"})}(e);return(0,s.cookies)().set("auth-token",r,{httpOnly:!0,secure:!0,sameSite:"lax",maxAge:604800}),r}async function p(){(0,s.cookies)().delete("auth-token")}},3474:(e,r,t)=>{t.d(r,{Z:()=>n});var s=t(3524);let n=global.prisma||new s.PrismaClient}};var r=require("../../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[948,972,261,691],()=>t(2468));module.exports=s})();