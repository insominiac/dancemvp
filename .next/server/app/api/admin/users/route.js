"use strict";(()=>{var e={};e.id=628,e.ids=[628],e.modules={3524:e=>{e.exports=require("@prisma/client")},2934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},2781:e=>{e.exports=require("stream")},3837:e=>{e.exports=require("util")},7501:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>q,patchFetch:()=>v,requestAsyncStorage:()=>f,routeModule:()=>g,serverHooks:()=>x,staticGenerationAsyncStorage:()=>h});var s={};t.r(s),t.d(s,{GET:()=>p,POST:()=>m});var n=t(9303),i=t(8716),a=t(670),o=t(7070),u=t(3524),l=t(8691),c=t(5306);let d=new u.PrismaClient;async function p(e){try{let r=await (0,c.kF)(e);console.log(`✅ Admin access granted to: ${r.email}`);let t=e.nextUrl.searchParams,s=parseInt(t.get("page")||"1"),n=parseInt(t.get("limit")||"10"),i=t.get("search")||"",a=t.get("role")||"",u=(s-1)*n,l={AND:[i?{OR:[{email:{contains:i,mode:"insensitive"}},{fullName:{contains:i,mode:"insensitive"}}]}:{},a?{role:a}:{}]},[p,m]=await Promise.all([d.user.findMany({where:l,skip:u,take:n,orderBy:{createdAt:"desc"},include:{instructor:!0,_count:{select:{bookings:!0,forumPosts:!0}}}}),d.user.count({where:l})]),g=p.map(({passwordHash:e,...r})=>r);return o.NextResponse.json({users:g,pagination:{total:m,page:s,limit:n,totalPages:Math.ceil(m/n)}})}catch(e){if(console.error("Error fetching users:",e),"Authentication required"===e.message)return o.NextResponse.json({error:"Authentication required"},{status:401});if("Admin privileges required"===e.message)return o.NextResponse.json({error:"Admin privileges required"},{status:403});return o.NextResponse.json({error:"Failed to fetch users"},{status:500})}}async function m(e){try{let r=await (0,c.kF)(e);console.log(`✅ Admin creating user: ${r.email}`);let{email:t,password:s,fullName:n,phone:i,role:a,bio:u,isVerified:p}=await e.json();if(await d.user.findUnique({where:{email:t}}))return o.NextResponse.json({error:"User with this email already exists"},{status:400});let m=await l.ZP.hash(s,10),g=await d.user.create({data:{email:t,passwordHash:m,fullName:n,phone:i,role:a||"USER",bio:u,isVerified:p||!1}});"INSTRUCTOR"===a&&await d.instructor.create({data:{userId:g.id,isActive:!0}});let{passwordHash:f,...h}=g;return o.NextResponse.json({message:"User created successfully",user:h},{status:201})}catch(e){if(console.error("Error creating user:",e),"Authentication required"===e.message)return o.NextResponse.json({error:"Authentication required"},{status:401});if("Admin privileges required"===e.message)return o.NextResponse.json({error:"Admin privileges required"},{status:403});return o.NextResponse.json({error:"Failed to create user"},{status:500})}}let g=new n.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/admin/users/route",pathname:"/api/admin/users",filename:"route",bundlePath:"app/api/admin/users/route"},resolvedPagePath:"/Users/hemantd/DL/dance-platform/app/api/admin/users/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:f,staticGenerationAsyncStorage:h,serverHooks:x}=g,q="/api/admin/users/route";function v(){return(0,a.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:h})}},5306:(e,r,t)=>{t.d(r,{Ov:()=>p,ed:()=>d,kF:()=>c});var s=t(1615),n=t(1482),i=t.n(n),a=t(3474);let o=()=>process.env.JWT_SECRET||"development-secret-key-replace-in-production";async function u(e){try{return i().verify(e,o())}catch(e){return console.error("Token verification failed:",e),null}}async function l(e){try{let r=e.headers.get("authorization"),t=r?.replace("Bearer ",""),n=s.cookies().get("auth-token")?.value,i=t||n;if(!i)return null;let o=await u(i);if(!o)return null;return await a.Z.user.findUnique({where:{id:o.userId},select:{id:!0,email:!0,fullName:!0,role:!0,isVerified:!0}})}catch(e){return console.error("Error getting current user:",e),null}}async function c(e){let r=await l(e);if(!r)throw Error("Authentication required");if(r?.role!=="ADMIN")throw Error("Admin privileges required");return r}async function d(e){let r=function(e){let r={userId:e.id,email:e.email,role:e.role};return i().sign(r,o(),{expiresIn:"7d"})}(e);return(0,s.cookies)().set("auth-token",r,{httpOnly:!0,secure:!0,sameSite:"lax",maxAge:604800}),r}async function p(){(0,s.cookies)().delete("auth-token")}},3474:(e,r,t)=>{t.d(r,{Z:()=>n});var s=t(3524);let n=global.prisma||new s.PrismaClient}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[948,972,261,691],()=>t(7501));module.exports=s})();